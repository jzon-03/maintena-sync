<div class="inventory-container">
  <!-- Header Section -->
  <div class="inventory-header">
    <h1>Parts Inventory</h1>
    <p class="subtitle">Manage spare parts and inventory levels</p>
  </div>
  
  <!-- Mobile Alert Banner -->
  <div class="mobile-alert-banner" *ngIf="lowStockParts.length > 0">
    <mat-icon class="alert-banner-icon">warning</mat-icon>
    <span class="alert-text">{{lowStockParts.length}} parts need restocking</span>
    <button mat-stroked-button color="warn" class="view-alerts-btn" (click)="scrollToAlerts()">
      View
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon total">inventory</mat-icon>
          <div class="stat-info">
            <h3>{{getInventoryStats().totalParts}}</h3>
            <p>Total Parts</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon value">attach_money</mat-icon>
          <div class="stat-info">
            <h3>${{getInventoryStats().totalValue | number:'1.0-0'}}</h3>
            <p>Total Value</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon low-stock">warning</mat-icon>
          <div class="stat-info">
            <h3>{{getInventoryStats().lowStock}}</h3>
            <p>Low Stock</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon out-stock">remove_circle</mat-icon>
          <div class="stat-info">
            <h3>{{getInventoryStats().outOfStock}}</h3>
            <p>Out of Stock</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="inventory-content">
    <!-- Main Inventory Table -->
    <div class="main-section">
      <!-- Filters and Search -->
      <mat-card class="filters-card">
        <mat-card-content>
          <div class="filters-content">
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>Search Parts</mat-label>
              <input matInput (keyup)="applyTextFilter($event)" placeholder="Search by name, part number, manufacturer...">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>Category</mat-label>
              <mat-select [(value)]="selectedCategory" (selectionChange)="applyCategoryFilter()">
                <mat-option *ngFor="let category of categories" [value]="category">
                  {{category === 'all' ? 'All Categories' : category}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>Status</mat-label>
              <mat-select [(value)]="selectedStatus" (selectionChange)="applyStatusFilter()">
                <mat-option *ngFor="let status of statusOptions" [value]="status">
                  {{status === 'all' ? 'All Status' : status}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <button mat-raised-button color="primary" class="add-part-btn">
              <mat-icon>add</mat-icon>
              Add Part
            </button>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Parts Table -->
      <div class="table-container">
        <!-- Mobile Cards View -->
        <div class="mobile-cards" *ngIf="false">
          <mat-card *ngFor="let part of dataSource.filteredData" class="part-card">
            <mat-card-header>
              <div class="part-card-header">
                <h3>{{part.name}}</h3>
                <span class="part-number">{{part.partNumber}}</span>
              </div>
            </mat-card-header>
            
            <mat-card-content>
              <div class="part-card-content">
                <div class="card-row">
                  <span class="label">Category:</span>
                  <span class="category-badge" [ngClass]="'category-' + part.category.toLowerCase()">
                    {{part.category}}
                  </span>
                </div>
                
                <div class="card-row">
                  <span class="label">Stock:</span>
                  <div class="stock-mobile">
                    <span class="current-stock" [ngClass]="{'low-stock': part.currentStock <= part.minimumStock}">
                      {{part.currentStock}}
                    </span>
                    <span class="stock-range">/ {{part.minimumStock}}-{{part.maximumStock}}</span>
                  </div>
                </div>
                
                <div class="card-row">
                  <span class="label">Status:</span>
                  <span class="status-badge" [ngClass]="'status-' + part.status.toLowerCase().replace(' ', '-')">
                    {{part.status}}
                  </span>
                </div>
                
                <div class="card-row">
                  <span class="label">Price:</span>
                  <span class="price">${{part.unitPrice | number:'1.2-2'}}</span>
                </div>
                
                <div class="card-row">
                  <span class="label">Location:</span>
                  <span class="location">{{part.location}}</span>
                </div>
              </div>
            </mat-card-content>
            
            <mat-card-actions>
              <button mat-icon-button color="primary" matTooltip="Add Stock">
                <mat-icon>add_circle</mat-icon>
              </button>
              <button mat-icon-button color="warn" matTooltip="Remove Stock">
                <mat-icon>remove_circle</mat-icon>
              </button>
              <button mat-icon-button matTooltip="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button matTooltip="View">
                <mat-icon>visibility</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
        
        <!-- Desktop Table View -->
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSource" matSort class="parts-table">
          <!-- Part Number Column -->
          <ng-container matColumnDef="partNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Part Number</th>
            <td mat-cell *matCellDef="let part">
              <div class="part-number">
                <strong>{{part.partNumber}}</strong>
              </div>
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Part Name</th>
            <td mat-cell *matCellDef="let part">
              <div class="part-details">
                <h4>{{part.name}}</h4>
                <p *ngIf="!isTablet && !isMobile">{{part.description}}</p>
                <div class="part-meta" *ngIf="!isTablet && !isMobile">
                  <span class="manufacturer">{{part.manufacturer}}</span>
                </div>
                <!-- Mobile/Tablet additional info -->
                <div *ngIf="isTablet || isMobile" class="mobile-info">
                  <small class="part-number-mobile">{{part.partNumber}}</small>
                  <span class="category-badge-small" [ngClass]="'category-' + part.category.toLowerCase()">
                    {{part.category}}
                  </span>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Category Column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Category</th>
            <td mat-cell *matCellDef="let part">
              <span class="category-badge" [ngClass]="'category-' + part.category.toLowerCase()">
                {{part.category}}
              </span>
            </td>
          </ng-container>

          <!-- Stock Column -->
          <ng-container matColumnDef="currentStock">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Stock</th>
            <td mat-cell *matCellDef="let part">
              <div class="stock-info">
                <div class="stock-numbers">
                  <span class="current-stock" [ngClass]="{'low-stock': part.currentStock <= part.minimumStock}">
                    {{part.currentStock}}
                  </span>
                  <span class="stock-range">/ {{part.minimumStock}}-{{part.maximumStock}}</span>
                </div>
                <div class="stock-bar">
                  <div class="stock-progress" 
                       [style.width.%]="(part.currentStock / part.maximumStock) * 100"
                       [ngClass]="{'low-stock': part.currentStock <= part.minimumStock}">
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let part">
              <span class="status-badge" [ngClass]="'status-' + part.status.toLowerCase().replace(' ', '-')">
                <mat-icon class="status-icon">
                  {{part.status === 'In Stock' ? 'check_circle' : 
                    part.status === 'Low Stock' ? 'warning' :
                    part.status === 'Out of Stock' ? 'remove_circle' :
                    part.status === 'Expired' ? 'schedule' : 'block'}}
                </mat-icon>
                {{part.status}}
              </span>
            </td>
          </ng-container>

          <!-- Price Column -->
          <ng-container matColumnDef="unitPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Unit Price</th>
            <td mat-cell *matCellDef="let part">
              <div class="price-info">
                <span class="unit-price">${{part.unitPrice | number:'1.2-2'}}</span>
              </div>
            </td>
          </ng-container>

          <!-- Total Value Column -->
          <ng-container matColumnDef="totalValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Value</th>
            <td mat-cell *matCellDef="let part">
              <div class="total-value">
                <strong>${{part.totalValue | number:'1.2-2'}}</strong>
              </div>
            </td>
          </ng-container>

          <!-- Location Column -->
          <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
            <td mat-cell *matCellDef="let part">
              <div class="location-info">
                <mat-icon class="location-icon">place</mat-icon>
                {{part.location}}
              </div>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let part">
              <div class="action-buttons">
                <button mat-icon-button color="primary" matTooltip="Add Stock">
                  <mat-icon>add_circle</mat-icon>
                </button>
                
                <button mat-icon-button color="warn" matTooltip="Remove Stock">
                  <mat-icon>remove_circle</mat-icon>
                </button>
                
                <button mat-icon-button matTooltip="Edit Part">
                  <mat-icon>edit</mat-icon>
                </button>
                
                <button mat-icon-button matTooltip="View Details">
                  <mat-icon>visibility</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="currentColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: currentColumns;"></tr>

          <!-- No data row -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="currentColumns.length">
              <div class="no-data-message">
                <mat-icon>inventory_2</mat-icon>
                <p>No parts found matching your criteria</p>
              </div>
            </td>
          </tr>
          </table>
        </div>
      </div>

      <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" 
                     aria-label="Select page of parts"
                     showFirstLastButtons>
      </mat-paginator>
      
      <!-- Alerts and Activity Section (Below Table) -->
      <div class="section-divider">
        <h2 class="section-title">
          <mat-icon>dashboard</mat-icon>
          Activity & Alerts
        </h2>
      </div>
      <div class="below-table-section">
        <!-- Low Stock Alert -->
        <mat-card class="alert-card low-stock-alert" *ngIf="lowStockParts.length > 0">
          <mat-card-header>
            <mat-card-title>
              <mat-icon class="alert-icon">warning</mat-icon>
              Low Stock Alert
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <div *ngFor="let part of lowStockParts" class="alert-item">
              <div class="alert-header">
                <strong>{{part.name}}</strong>
                <span class="stock-count">{{part.currentStock}} left</span>
              </div>
              <p class="part-number">{{part.partNumber}}</p>
              <div class="alert-actions">
                <button mat-stroked-button color="primary" size="small">
                  <mat-icon>shopping_cart</mat-icon>
                  Reorder
                </button>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Recent Stock Movements -->
        <mat-card class="movements-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>swap_horiz</mat-icon>
              Recent Movements
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <div *ngFor="let movement of recentMovements.slice(0, 8)" class="movement-item">
              <div class="movement-header">
                <div class="movement-type" [ngClass]="'movement-' + movement.movementType.toLowerCase()">
                  <mat-icon>
                    {{movement.movementType === 'In' ? 'arrow_downward' : 'arrow_upward'}}
                  </mat-icon>
                  <span>{{movement.movementType}}</span>
                </div>
                <span class="movement-quantity">{{movement.quantity}}</span>
              </div>
              
              <p class="movement-part">{{movement.partName}}</p>
              <p class="movement-reason">{{movement.reason}}</p>
              <span class="movement-date">{{movement.date | date:'MMM d, HH:mm'}}</span>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Quick Stats -->
        <mat-card class="quick-stats-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>analytics</mat-icon>
              Quick Stats
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <div class="quick-stat">
              <span class="stat-label">Categories</span>
              <span class="stat-value">{{getInventoryStats().categories}}</span>
            </div>
            
            <div class="quick-stat">
              <span class="stat-label">Avg. Part Value</span>
              <span class="stat-value">${{(getInventoryStats().totalValue / getInventoryStats().totalParts) | number:'1.0-0'}}</span>
            </div>
            
            <div class="quick-stat">
              <span class="stat-label">Stock Health</span>
              <span class="stat-value">
                {{((getInventoryStats().totalParts - getInventoryStats().lowStock - getInventoryStats().outOfStock) / getInventoryStats().totalParts * 100) | number:'1.0-0'}}%
              </span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Sidebar with Alerts and Recent Activity (Hidden - moved below table) -->
    <div class="sidebar-section" style="display: none;">
      <!-- Expiring Parts Alert -->
      <mat-card class="alert-card expiring-alert" *ngIf="expiringParts.length > 0">
        <mat-card-header>
          <mat-card-title>
            <mat-icon class="alert-icon">schedule</mat-icon>
            Expiring Soon
          </mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <div *ngFor="let part of expiringParts" class="alert-item">
            <div class="alert-header">
              <strong>{{part.name}}</strong>
              <span class="expiry-date">{{part.expiryDate | date:'MMM d'}}</span>
            </div>
            <p class="part-number">{{part.partNumber}}</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
